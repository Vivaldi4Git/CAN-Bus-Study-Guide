# 什么是SDO？

SDO（Service Data Object）即服务数据对象，是CANopen协议中用于访问设备对象字典的一种通信机制。
SDO 传输采用的是CS模式， 也就是客户端-服务器模式。

# SDO和PDO

SDO的职责更在于设置基础配置，是foundation，设置设备参数等
PDO的职责在于利用这一套机制做操作, 比如运行时发送实时的速度设定值和读取实际速度等。
这也是为什么预操作状态时，可以SDO通信，但是PDO不行。

# SDO的通信原则

## 为什么需要通信原则？

如果说PDO是IM中的在线状态或预设的快捷回复，发出后不需要等待对方回应，结构样式也相对简单。

那么SDO就是IM中的文字消息，发出后需要等待对方回应，类似于一问一答的对话模式， 结构样式也相对复杂。

PDO像是简单、快速的状态更新，而SDO更像是复杂、可靠的数据交换过程。

## 通信原则

600h （600h + Node-ID）被定义为"客户端到服务器"的方向。
580h （580h + Node-ID）被定义为"服务器到客户端"的方向。

## 为什么要这么规定？

这是因为最大 Node-ID (127) = 111 1111, 而600h, 580h 的二进制表示中，这几位不会与Node-ID冲突。

```
110 0000 0000 (600h)
101 1000 0000 (580h)
     111 1111 (580h)
```

也方便看出方向上的差别。

# 快速SDO

最常用最常见的 SDO 协议是快速 SDO，所谓快速，就是 1 次来回就搞定。
前提是读取和写入的值不能大于 32 位，也就是4个字节。

![](../attachments/Pasted%20image%2020241016104903.png)

简单来说
2xh：写入操作       
4xh：读取操作

通过快速 SDO，可以直接对 CANopen 节点的对象字典中的值进行读取和修改，所以在
做参数配置之外，也经常作为关键性数据传输之用。比如 CANopen 控制机器人的电机转动
角度时，就使用 SDO 来传输，保证可靠到达。

对于频繁访问的小数据，优先使用快速SDO。

# 普通SDO

当需要传输的值超过 32 位时，就不能使用快速 SDO 传输。必须使用普通 SDO 进行分
帧传输。在应用中较少用到，一般用于 CANopen 节点的程序固件升级，或者做网关转换
MVB 总线之类数据最大可达 256 位的应用。

下面是SDO上传协议

![](../attachments/Pasted%20image%2020241016110342.png)

可以看到比快速SDO要复杂的多。
简单来说，可以分为

1. 初始化
2. 数据分段传输

打头的一对请求和响应，就是初始化。

下面的是数据分段传输，客户端请求数据，服务端进行响应。
这也分成三个阶段：
1. 第一分段
2. 中间分段
3. 最后分段

整个过程是连续的，最后一个分段自然地标志着传输的结束

图中的的70h和60h交替可能有些迷惑，其实是由于中间分段有多个请求，比如上一次发60h打头，这次发70h打头，交替进行。

最后分段请求的CS也会由上一个决定。

下载协议也是类似。

![](../attachments/Pasted%20image%2020241016134514.png)
	
# 下一章

- [特殊协议](特殊协议.md)