在上一章中，我们学习了CANopen的SDO,PDO。
他们是CANopen中的协议， 当然也可被视作对象。

# 同步协议

同步协议是CANopen中的一种协议，主要实现整个网络的同步传输。

在[CANopenPDO](CANopenPDO.md)中PDO的传输方式有同步传输，而同步协议就是为同步传输服务的。

PDO是生产-消费模式。

所以同步协议的模式如下。

![](../attachments/Pasted%20image%2020241016143711.png)

下面是周期性同步报文发送的一个时间轴，每个竖线代表一个同步报文。
红线是时间轴， 而指出的约束条件是对象字典设置的一些参数。

![](../attachments/Pasted%20image%2020241016144003.png)

同步窗口时间：索引 1007h约束了同步帧发送后，从节点发送 PDO 的时效，即在这个时间内发送的 PDO 才有效，超过时间的 PDO 将被丢弃；
通讯循环周期：索引 1006h规定了同步帧的循环周期。

一般同步报文由 NMT 主机发出，CAN 报文的数据为 0 字节。

一个网络中可能有多个同步机制，怎么区分？这就需要设置不同的同步节拍， 比如：
某些节点接收1个同步帧，发送1次PDO。
某些节点接收2个同步帧，发送1次PDO。

所以这里PDO参数中的同步起始值就起了作用， 他就是用于设置上述节拍的。
所谓同步帧， 就是用于同步的CAN帧。
而这个同步帧的配置，则是同步对象决定的。

# 时间戳协议

时间标记对象（Time Stamp），NMT 主机发送自身的时钟，为网络各个节点提供公共的时间参考，即网络对时。
时间戳协议采用广播方式，无需节点应答，CAN-ID 为 100h，数据长度为 6，数据为当前时刻与 1984 年 1 月 1 日 0 时的时间差。

![](../attachments/Pasted%20image%2020241016150552.png)

# 紧急报文协议

紧急报文用于报告设备内部的错误或异常状态。

![](../attachments/Pasted%20image%2020241016153513.png)

EEC 表如下
![](../attachments/Pasted%20image%2020241016153549.png)

与 PDO 的生产禁止时间类似，紧急报文也有生产禁止时间，存储在对象字典的 1015h中，为了限制节点不断发送紧急报文，导致总线负载过大。